<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%= slug %> FP History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .b {
            display: flex;
            flex-flow: row wrap;
            width: 100%;
            overflow: auto;
        }
        @media(min-width: 1200px) {
            .a {
                flex: 0 0 100%;
            }
        }
        @media(max-width: 1200px) {
            .a {
                flex: 0 0 100%;
            }
        }
        .a {
            height: 100vh;
            border-style: solid;
            border-width: 1px;
            border-color: #000;
            display: flex;
            flex-flow: column;
            padding: 10px;
        }
        p {
            flex: 0 0 auto;
        }
        .c {
            flex: 1 1 0;
        }
    </style>
    <script>
        let chart;
        $(document).ready(function () {
            let parent = $('#1')
            let canvas = document.getElementById('c1')
            canvas.width = parent.width();
            canvas.height = parent.height();
            $.ajax({
                url: '/api/stats',
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                },
                error: function (jqXHR, error, exception) {
                    console.error(exception)
                },
                success: function (data) {
                    let labels = []
                    let values = []
                    let min = 9999
                    let max = 0
                    for (let row of data) {
                        labels.push(new Date(row[0] * 1000 * 60).toString().split(' ').slice(1, 5).join(' '))
                        values.push(row[1])
                        if (row[1] < min) min = row[1]
                        if (row[1] > max) max = row[1]
                    }
                    let range = max - min
                    let graphMin = min - (range * 0.15)
                    let graphMax = max + (range * 0.15)
                    const ctx = document.getElementById('c1').getContext('2d')
                    chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels,
                            datasets: [{
                                label: "FP (ETH)",
                                data: values,
                                borderColor: '#4287f5',
                                fill: false,
                                pointRadius: 0,
                                tension: 0.2
                            }]
                        },
                        options: {
                            animation: {
                                duration: 0
                            },
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    grace: '15%'
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false
                    })
                }
            })
        })
    </script>
</head>
<body style="width: 100%; height: 100%">
    <div class="b">
        <div class="a">
            <p class="text-center">FP History</p>
            <div class="c" id="1">
                <canvas id="c1"></canvas>
            </div>
        </div>
    </div>
</body>
</html>